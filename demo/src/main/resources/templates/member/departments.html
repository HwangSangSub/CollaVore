<div class="page-wrapper" xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="Content">
<style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #6f42c1;
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .btn:hover {
            background-color: #563d7c;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: #f4f4f9;
        }

        .action-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        .action-btn:hover {
            background-color: #d32f2f;
        }

        .action-btn.edit {
            background-color: #4caf50;
        }

        .action-btn.edit:hover {
            background-color: #388e3c;
        }

        .tree-structure ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        .tree-structure ul ul {
            margin-left: 20px;
        }

        .tree-structure li {
            padding: 5px;
            margin: 5px 0;
            background-color: #e6e6fa;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tree-structure li .actions {
            display: flex;
            gap: 5px;
        }

        .input-box {
            width: 100%;
            padding: 5px;
            margin: 5px 0;
        }

        .form-container {
            margin-bottom: 20px;
        }

    </style>

	    <div class="container">
        <h2>부서 관리</h2>

        <!-- 부서 추가 입력폼 -->
        <div class="form-container">
            <input type="text" id="deptName" class="input-box" placeholder="부서명 입력" required>
            <input type="number" id="mgrNo" class="input-box" placeholder="부서장 사원번호 입력" required>
            <input type="number" id="parentDeptNo" class="input-box" placeholder="상위부서 번호 입력 (없으면 0)">
            <input type="number" id="sort" class="input-box" placeholder="정렬 순서 입력" required>
            <button class="btn" onclick="addDepartment()">부서 추가</button>
        </div>

        <!-- 부서 트리 구조 -->
        <div class="tree-structure">
            <ul id="deptTree">
                <!-- 부서 리스트가 여기에 동적으로 추가됩니다 -->
            </ul>
        </div>

        <!-- 부서 테이블 -->
        <table>
            <thead>
                <tr>
                    <th>부서 번호</th>
                    <th>부서명</th>
                    <th>부서장</th>
                    <th>상위 부서</th>
                    <th>정렬 순서</th>
                    <th>액션</th>
                </tr>
            </thead>
            <tbody id="deptTableBody">
                <!-- 부서 데이터가 여기에 동적으로 추가됩니다 -->
            </tbody>
        </table>
    </div>
</div>



<script>
// 부서 데이터를 저장하는 배열
let departments = [];
let deptCounter = 1; // 부서 번호를 자동으로 생성하는 카운터

// 부서 추가 함수
function addDepartment() {
    const deptName = document.getElementById('deptName').value;
    const mgrNo = document.getElementById('mgrNo').value;
    const parentDeptNo = document.getElementById('parentDeptNo').value || null;
    const sort = document.getElementById('sort').value;

    if (!deptName || !mgrNo || !sort) {
        alert('필수 입력 항목을 모두 입력해 주세요.');
        return;
    }

    const newDept = {
        deptNo: deptCounter++,
        deptName,
        mgrNo: parseInt(mgrNo),
        parentDeptNo: parentDeptNo ? parseInt(parentDeptNo) : null,
        sort: parseInt(sort)
    };

    departments.push(newDept);
    renderDepartments();
    clearForm();
}

// 부서 수정 함수
function editDepartment(deptNo) {
    const dept = departments.find(d => d.deptNo === deptNo);
    if (dept) {
        const newName = prompt("부서명을 수정하세요:", dept.deptName);
        const newMgrNo = prompt("부서장 사원번호를 수정하세요:", dept.mgrNo);
        const newSort = prompt("정렬 순서를 수정하세요:", dept.sort);

        if (newName) dept.deptName = newName;
        if (newMgrNo) dept.mgrNo = parseInt(newMgrNo);
        if (newSort) dept.sort = parseInt(newSort);

        renderDepartments();
    }
}

// 부서 삭제 함수
function deleteDepartment(deptNo) {
    const confirmed = confirm("정말로 이 부서를 삭제하시겠습니까?");
    if (confirmed) {
        departments = departments.filter(d => d.deptNo !== deptNo);
        renderDepartments();
    }
}

// 부서 트리 구조 및 테이블을 화면에 렌더링하는 함수
function renderDepartments() {
    // 트리 구조 렌더링
    document.getElementById('deptTree').innerHTML = createDeptTree(departments);

    // 테이블 렌더링
    loadDeptTable(departments);
}

// 부서 트리 구조를 생성하는 함수
function createDeptTree(departments, parentDeptNo = null) {
    let html = '';
    departments
        .filter(dept => dept.parentDeptNo === parentDeptNo)
        .forEach(dept => {
            html += `
                <li>
                    ${dept.deptName} (부서장: ${dept.mgrNo})
                    <div class="actions">
                        <button class="action-btn edit" onclick="editDepartment(${dept.deptNo})">수정</button>
                        <button class="action-btn" onclick="deleteDepartment(${dept.deptNo})">삭제</button>
                    </div>
                    <ul>${createDeptTree(departments, dept.deptNo)}</ul>
                </li>
            `;
        });
    return html;
}

// 부서 테이블을 로드하는 함수
function loadDeptTable(departments) {
    const deptTableBody = document.getElementById('deptTableBody');
    deptTableBody.innerHTML = '';
    departments.forEach(dept => {
        deptTableBody.innerHTML += `
            <tr>
                <td>${dept.deptNo}</td>
                <td>${dept.deptName}</td>
                <td>${dept.mgrNo}</td>
                <td>${dept.parentDeptNo || '최상위 부서'}</td>
                <td>${dept.sort}</td>
                <td>
                    <button class="action-btn edit" onclick="editDepartment(${dept.deptNo})">수정</button>
                    <button class="action-btn" onclick="deleteDepartment(${dept.deptNo})">삭제</button>
                </td>
            </tr>
        `;
    });
}

// 입력폼 초기화 함수
function clearForm() {
    document.getElementById('deptName').value = '';
    document.getElementById('mgrNo').value = '';
    document.getElementById('parentDeptNo').value = '';
    document.getElementById('sort').value = '';
}

</script>                                                                                                                                                                                                                                                                                                                