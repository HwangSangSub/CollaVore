<div class="page-wrapper" xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="Content">

<style>
/* 페이지 기본 스타일 */
.page-wrapper {
	padding: 20px;
	background-color: #f9f9f9;
	display: flex;
	flex-direction: column;
	align-items: center;
}

/* Breadcrumb 스타일 */
.breadcrumb {
	background-color: #ffffff;
	padding: 5px 20px;
	border-radius: 10px;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	height: 70px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	width: calc(100% - 40px);
	max-width: 1000px;
	margin-bottom: 20px;
	color: #333;
	position: relative;
}

.breadcrumb-left h4 {
	font-size: 24px;
	font-weight: bold;
}

.breadcrumb-left p {
	margin-top: 5px;
	font-size: 14px;
	color: #666;
}

.breadcrumb-right {
	position: absolute;
	right: 20px;
	top: 20px;
}

/* 카드 스타일 */
.card_userInfo, .card_table {
	background-color: #ffffff;
	padding: 20px;
	border-radius: 10px;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	width: calc(100% - 40px);
	max-width: 1000px;
	margin-bottom: 20px;
	display: flex;
	flex-direction: column;
	position: relative;
}

/* 프로필 섹션 */
.profile-section {
	display: flex;
	align-items: flex-start;
	margin-bottom: 20px;
	position: relative;
}

/* 프로필 이미지 스타일 */
.profile-photo img {
	width: 100px;
	height: 100px;
	border-radius: 50%;
	margin-right: 20px;
}

/* 프로필 정보 */
.profile-details {
	flex-grow: 1;
	margin-right: 120px;
}

/* 텍스트 영역 크기 조정 */
.profile-details textarea {
	width: 100%;
	height: 60px;
	resize: none;
	font-size: 14px;
	padding: 10px;
	margin-bottom: 20px;
}

/* 정보 수정 버튼 */
.edit-button {
	position: absolute;
	top: 10px;
	right: 10px;
	padding: 8px 12px;
	background-color: #6c5ce7;
	color: white;
	border: none;
	border-radius: 5px;
	cursor: pointer;
}

.edit-button:hover {
	background-color: #5a4bcf;
}

/* 테이블 섹션 스타일 */
.table-section {
	margin-top: 20px;
}

.table-section h2 {
	font-size: 18px;
	margin-bottom: 10px;
	color: #555;
}

/* 테이블 스타일 */
table {
	width: 100%;
	table-layout: fixed;
	border-collapse: collapse;
}

th, td {
	padding: 10px;
	text-align: center;
	vertical-align: middle;
	border-bottom: 1px solid #ddd;
}

th {
	background-color: #f0f0f0;
	font-weight: bold;
	color: #555;
}

td {
	color: #333;
}

/* 모달 창 스타일 */
.modal {
	display: none;
	position: fixed;
	z-index: 1000;
	left: 50%;
	top: 50%;
	transform: translate(-50%, -50%);
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
	background-color: #fff;
	margin: auto;
	padding: 20px;
	border-radius: 10px;
	width: 50%;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	position: relative;
}

.close {
	color: #aaa;
	float: right;
	font-size: 28px;
	font-weight: bold;
}

.close:hover, .close:focus {
	color: #000;
	text-decoration: none;
	cursor: pointer;
}

/* 프로필 이미지 스타일 */
.profile-photo {
	display: flex;
	justify-content: center; /* 이미지가 중앙에 배치되도록 설정 */
	margin-bottom: 15px;
}

.profile-photo img {
	width: 100px;
	height: 100px;
	border-radius: 50%;
}

/* 폼 요소 스타일 */
.form-group {
	margin-bottom: 15px;
}

label {
	display: block;
	font-weight: bold;
}

input[type="text"], textarea {
	width: 100%;
	padding: 8px;
	margin-top: 5px;
	border-radius: 4px;
	border: 1px solid #ddd;
	box-sizing: border-box;
}

button {
	padding: 10px 20px;
	background-color: #5cb85c;
	color: white;
	border: none;
	border-radius: 5px;
	cursor: pointer;
}

button:hover {
	background-color: #4cae4c;
}

/* 수정된 프로필 이미지 스타일 */
.profile-photo img.default-image {
	width: 100px;
	height: 100px;
	border-radius: 50%;
	background-color: #f0f0f0; /* 기본 이미지의 배경색 설정 */
	object-fit: cover;
}
</style>
	<div class="purple-background-container">
		<div class="breadcrumb">
			<div class="breadcrumb-left">
				<h4>인사정보기록</h4>
				<p>나의 인사 기본정보를 볼 수 있는 공간입니다.</p>
			</div>
			<div class="breadcrumb-right">
				<span>관리자 페이지 > 조직관리</span>
			</div>
		</div>

		<!-- 인사정보 Section -->
		<div class="card_userInfo">
			<!-- 프로필 이미지와 사용자 정보 -->
			<div class="profile-section">
				<div class="profile-photo">
					<img
						th:src="${member.img != null and member.img != '' ? '/assets/images/users/' + member.img : '/assets/images/users/default.png'}"
						alt="사용자 이미지">
				</div>
				<div class="profile-details">
					<textarea rows="3" cols="100" th:text="${member.info}" readonly></textarea>
					<h3 th:text="${member.empName}">이름</h3>
					<p th:text="${member.tel}">전화번호</p>
					<p th:text="${member.email}">이메일</p>
					<p th:text="${member.workType}">근무형태</p>
					<p th:text="${member.deptName}">사원번호</p>
				</div>
				<!-- 정보 수정 버튼 -->
				<button class="edit-button" id="editBtn">정보 수정</button>
			</div>
		</div>

		<div class="card_table">
			<h4>인사정보</h4>
			<table>
				<tr>
					<th>고용형태</th>
					<th>입사일자</th>
					<th>소속</th>
					<th>직책</th>
					<th>직급</th>
				</tr>
				<tr>
					<td th:text="${member.workType}"></td>
					<td th:text="${#dates.format(member.joinDate, 'yyyy-MM-dd')}"></td>
					<td th:text="${member.deptName}"></td>
					<td th:text="${member.jobName}"></td>
					<td th:text="${member.posiName}"></td>
				</tr>
			</table>
		</div>

		<div class="card_table">
			<h4>전자결재 이력 OR 바로가기</h4>
			<table>
				<tr>
					<th>우상이가</th>
					<th>완료하면</th>
					<th>추가</th>
					<th>할</th>
					<th>예정</th>
				</tr>
				<tr>
					<td th:text="${member.workType}"></td>
					<td th:text="${#dates.format(member.joinDate, 'yyyy-MM-dd')}"></td>
					<td th:text="${member.deptName}"></td>
					<td th:text="${member.jobName}"></td>
					<td th:text="${member.posiName}"></td>
				</tr>
			</table>
		</div>
		<!-- 모달 구조 -->
		<div id="editModal" class="modal">
			<div class="modal-content">
				<span class="close">&times;</span>
				<h2>정보 수정</h2>
				<form id="editForm" enctype="multipart/form-data"
					th:action="@{/memberEdit}" th:object="${member}" method="post">
					<div class="form-group" style="text-align: center;">
						<div style="display: inline-block; position: relative;">
							<div class="profile-photo">
								<img id="profilePreview"
									th:src="${member.img != null ? '/assets/images/users/' + member.img : '/assets/images/users/default.png'}"
									alt="프로필 이미지" width="100" height="100">
							</div>
							<input type="file" id="profileImage" name="profileImage"
								accept="image/*" onchange="previewImage(event)"> <label>이미지
								파일 선택</label>
						</div>
					</div>

					<!-- 소개글 수정 -->
					<div class="form-group" style="text-align: center;">
						<textarea id="info" name="info" rows="3"
							placeholder="본인이 쓸 수 있는 소개글 공간" th:field="*{info}"></textarea>
					</div>

					<!-- 이름 및 전화번호 수정 -->
					<div style="text-align: left; margin: 0 auto; width: 80%;">
						<div class="form-group">
							<label for="name">이름 :</label> <input type="text" id="name"
								name="name" th:field="*{empName}">
						</div>
						<div class="form-group">
							<label for="tel">연락처 :</label> <input type="text" id="tel"
								name="tel" th:field="*{tel}">
						</div>
						<!-- 이메일 및 부서/직책 정보는 읽기 전용 -->
						<div class="form-group">
							<label>이메일 :</label> <span th:text="*{email}"></span>
						</div>
						<div class="form-group">
							<label>부서/직책 :</label> <span
								th:text="*{deptName} + ' | ' + *{jobName}"></span>
						</div>
						<div class="form-group">
							<label>사원번호 :</label> <span th:text="*{empNo}"></span>
						</div>
					</div>

					<!-- 저장 버튼 -->
					<div style="text-align: center; margin-top: 20px;">
						<button type="submit">정보 수정</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script>
	// 모달 관련 요소 가져오기
    var modal = document.getElementById("editModal");
    var btn = document.getElementById("editBtn"); // '정보 수정' 버튼
    var span = document.querySelector(".close");

    // 수정 버튼을 클릭하면 모달을 엽니다.
    btn.onclick = function() {
        modal.style.display = "block";

        // 사용자의 프로필 이미지를 불러와서 기본 이미지가 없으면 default.png를 표시
        var imgPath = /*[[${member.img}]]*/ '';
        var profilePreview = document.getElementById("profilePreview");
        
        if (!imgPath || imgPath === '') {
            profilePreview.src = '/assets/images/users/default.png'; // 기본 이미지 경로
        } else {
            profilePreview.src = '/assets/images/users/' + imgPath;
        }
    }

    // X 버튼을 클릭하면 모달을 닫습니다.
    span.onclick = function() {
        modal.style.display = "none";
    }

    // 바깥을 클릭하면 모달을 닫습니다.
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // 이미지 미리보기
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function() {
            const output = document.getElementById('profilePreview');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }
	</script>
</div>  