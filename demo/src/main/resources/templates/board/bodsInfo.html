<div class="page-wrapper" xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="Content">


	<div class="text-center">
		<form name="insertForm" th:action="@{/boardInsert}" method="post">
			<h3>게시글 정보</h3>
			<table class="table">
				<tr>
					<th>제목</th>
					<td>[[${bods.title}]]</td>
				</tr>
				<tr>
					<th>작성자</th>
					<td>[[${bods.writer}]]</td>
				</tr>
				<tr>
					<th>내용</th>
					<td>[[${bods.content}]]</td>
				</tr>
				<tr>
					<th>작성일자</th>
					<!-- yyyy/MM/dd -->
					<td>[[${#dates.format(bods.regDate, 'yyyy/MM/dd')}]]</td>
				</tr>
				<tr>
					<th>수정일자</th>
					<td>[[${#dates.format(bods.modDate, 'yyyy/MM/dd')}]]</td>
					<!--<td>[[${bods.modDate}]]</td> -->
				</tr>

			</table>
			<button type="button"
				th:onclick='|location.href="@{/board/bodsUpdate(postNo=${bods.postNo})}"|'>수정</button>
			<button type="button"
				th:onclick='|location.href="@{/board/bodsList(boardNo=${bods.boardNo})}"|'>목록</button>
			<button type="button"
				th:onclick='|location.href="@{/board/bodsDelete(postNo=${bods.postNo}, boardNo=${bods.boardNo})}"|'>삭제</button>
		</form>

		<!-- 댓글창 -->
		<div class="text-center">
			<form name="insertBodsComts" th:action="@{/board/bodsComts}"
				method="post">
				<input type="hidden" name="postNo" th:value="${param.postNo}">
				<!-- 댓글 작성 부분 -->
				<h3>댓글 작성</h3>
				<input type="text" name="writer" placeholder="작성자"> <input
					type="text" name="content" placeholder="내용">
				<button type="button" id="btninsert">댓글작성</button>
			</form>

			<!--  -->
			<div id="comtslist">
				<table>
					<thead>
						<tr>
							<th>댓글번호</th>
							<th>작성자</th>
							<th>내용</th>
							<th>작성시간</th>
						</tr>
					</thead>
					<tbody id="bodsComts">
					</tbody>

				</table>
			</div>



		</div>
		<script>

		//ajax로 댓글 불러오기
					$.ajax({
							type: "get",
							url: "/board/comtsList?postNo=26",
							success: function(rs) {
								console.log(rs);// 서버에서 받은 결과
								rs.forEach(function(comt){
									console.log(comt.cmtNo);
									let row = '<tr>'+
									'<td>' + comt.cmtNo + '</td>' +
				                   '<td>' + comt.writer + '</td>' +
				                   '<td>' + comt.content + '</td>' +
				                   '<td>' + comt.regDate + '</td>' +
				                   '</tr>';
				                   console.log(row);
								});
								
							}
					});
	
					$("#btninsert").on('click', boardInsertHandler);
					function boardInsertHandler() {

						let writer = $('form [name="writer"]');
						if (writer.val() == '') {
							alert('작성자가 입력되지 않았습니다.');
							writer.focus();
							return;
						}

						let content = $('form [name="content"]');
						if (content.val() == '') {
							alert('내용이 입력되지 않았습니다.');
							content.focus();
							return;
						}

						//document.insertBodsComts.submit();
						console.log($(document.insertBodsComts).serialize());
						
						
					
					


						//등록아작스
						$.ajax({
							type : 'post',
							url : '/board/bodsComts',
							data : $(document.insertBodsComts).serialize(),
							success : function(data) {
								if (data == "success") {

									// getCommentList();
									content.val("");
								}

							},
							error : function(request, status, error) {
								//alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
							}

						});
						alert('댓글이 등록되었습니다.');
					}

					// 삭제 아작스
					function deletebodsComts(cmtNo) {

						if (confirm("정말 삭제하시겠습니까?") == true) {

							
							$.ajax({
								type : 'post',
								url : '/board/bodsComtsDelete',
								data : {cmtNo},
								success : function() {

								},
								error : function() {
									alert('ERROR')
								}
							})

							loadComments(cmtNo, 0);
						}
					}
				</script>
	</div>
</div>
